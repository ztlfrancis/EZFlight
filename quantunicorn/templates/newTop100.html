{% extends "home.html" %}
{% block head %}
    {{ super() }}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
     <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker3.min.css" >
<script
  src="https://code.jquery.com/jquery-3.6.0.js"
  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
  crossorigin="anonymous"></script>
{% endblock %}
{% block content %}
    <div class="container-fluid">
      <div class="container collapsed d-md-none mb-3 " data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-expanded="true" onclick="myFunction(this)">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </div>
      <div class="row ">
        <nav class=" bg-white d-md-block col-12 col-md-3 col-xl-2 bd-sidebar collapse" id="sidebarMenu" >
            {% block sidebarMenu %}
        <ul class="list-unstyled ps-0">
          <li class="mb-1">
            <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#home-collapse" aria-expanded="true">
              产品
            </button>
            <div class="collapse show" id="home-collapse">

              <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                <li><a href="/" class="link-dark rounded">资金流</a></li>
                <li><a href="#" class="link-dark rounded">多标的资金流</a></li>
                <li><a href="/qu100" class="link-dark rounded">QU 100</a></li>
                <li><a href="/indicator" class="link-dark rounded">资金流指标</a></li>
              </ul>
            </div>
          </li>
          <li class="mb-1">
            <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#dashboard-collapse" aria-expanded="false">
              更多
            </button>
            <div class="collapse" id="dashboard-collapse">
              <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                <li><a href="https://quantunicorn.zendesk.com/hc/zh-cn/requests/new" class="link-dark rounded">提交请求</a></li>
              </ul>
            </div>
          </li>

          <li class="border-top my-3"></li>
          <li class="mb-1">
            <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#account-collapse" aria-expanded="false">
              使用须知
            </button>
            <div class="collapse" id="account-collapse">
              <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                <li><a href="https://quantunicorn.medium.com/blog-1-capital-flow-index%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D-f40e54d93514" class="link-dark rounded">使用须知</a></li>
                <li><a href="https://www.quantunicorn.com/legal" class="link-dark rounded">使用条款</a></li>
                <li><a href="https://quantunicorn.medium.com/%E8%B5%84%E9%87%91%E6%B5%81%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%BC%8F%E6%A1%88%E4%BE%8B%E6%95%99%E5%AD%A6%E6%A8%A1%E5%BC%8F%E4%B8%80-6da736957b29" class="link-dark rounded">使用案例</a></li>
              </ul>
            </div>
          </li>
        </ul>
            {% endblock %}
      </nav>
        <div  class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content d-flex flex-column justify-content-center">
          <div class="bg-white" >

              <div class="row row-cols-lg-2 row-cols-md-2 row-cols-sm-1">
                <div class="col col-lg-6 col-md-3 mr-3">
                  <input type="text" class="form-control" id="date" name="date" data-provide="datepicker" data-date-format="yyyy-mm-dd">
                  <div class="invalid-feedback">
                    Please select a date.
                  </div>
                </div>
                <div class="col col-lg-6 col-md-4 ">
                  <button class="btn btn-md col-lg-3 col-md-2 btn-primary "  >查询</button>
                </div>
              </div>
              <div class="row">
                <div class=" btn-group mt-2" role="group" aria-label="Basic radio toggle button group">

                  <input type="radio" class="btn-check" name="frequency" id="daily" autocomplete="off"checked>
                  <label class="btn btn-outline-dark" for="daily">日线</label>

                  <input type="radio" class="btn-check" name="frequency" id="weekly" autocomplete="off">
                  <label class="btn btn-outline-dark" for="weekly">周线</label>
                </div>

                  <div class=" btn-group mt-2" role="group" aria-label="Basic radio toggle button group">
                  <input type="radio" class="btn-check" name="top" id="top" autocomplete="off" checked>
                  <label class="btn btn-outline-dark" for="top">前100</label>

                  <input type="radio" class="btn-check" name="top" id="bottom" autocomplete="off">
                  <label class="btn btn-outline-dark" for="bottom">后100</label>
                </div>


              </div>

          </div>

          <p class="h3">资金流指标</p>
            <button id="top100-but"  class="btn btn-primary mt-1">刷新</button>
             <pre id="top100" style="font-size: 16pt;"></pre>
            <div class="table-responsive" style="font-size:12px;">
    <table class="table table-striped table-sm" id="top100-table">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Ticker</th>
          <th>One-day change</th>
          <th>Sector</th>
          <th>Industry</th>
        </tr>
      </thead>
      <tbody id="top100-tbody"></tbody>
    </table>
  </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
     $("#top100-but").on('click', function (event) {
         $("#top100-tbody").html("");
         var frequency = 'hours';
         if($("#daily").is(":checked")){
             frequency = 'daily';
         }else if($("#weekly").is(":checked")){
             frequency = 'weekly';
         }

         $.ajax({

             //url: 'https://test.quantunicorn.com/api/v2/top100?date='+$("#date").val()+'&top=true&frequency=daily',
             url:'/test',
             type: "GET",
             dataType: "json",
             success: function (response) {
                 console.log('https://test.quantunicorn.com/api/v2/top100?date='+$("#date").val()+'&top='+$("#top").is(":checked")+'&frequency='+($("#daily").is(":checked") ? 'daily':'weekly'))
                console.log('1'+$("#top").is(":checked"))
                 console.log('2'+$("#bottom").is(":checked"))
                 clearInterval(window.counterBack);
                 $("#top100").text(response["message"]);
                 jQuery.each(response["data"], function (i, val) {
                     var changTd;
                     if (val['change'] > 0) {
                         changTd = '<td class=\'text-success\'>' + '&#9650;' + val['change'] + '</td>'
                     } else if (val['change'] < 0) {
                         changTd = '<td class=\'text-danger\'>' + '&#9660;' + Math.abs(val['change']) + '</td>'
                     } else {
                         changTd = '<td >' + val['change'] + '</td>'
                     }
                     $('#top100-tbody').append('<tr><td>' + val['rank'] + '</td><td>' + val['ticker'] + '</td>' + changTd + '<td>' + val['industry'] + '</td><td>' + val['sector'] + '</td></tr>');
                 });

             },
             error: function (error) {
                 console.log('error')
                 clearInterval(window.counterBack);
                 clearTimeout(timeout);
                 $("#progressbar").css("width", "100%");
                 $("#progressbar").addClass("bg-danger");
                 $("#top100").text("Server error " + error.status);
             },
             timeout: 50000
         });
     })
    var testRes = {message: 'Success\nLast updated on 2021-05-18 17:03 Eastern Time',data:[{rank:1,ticker:'AAPL',change:-5,industry:'tech',sector:'consumer tech'},{rank:1,ticker:'AAPL',change:5,industry:'tech',sector:'consumer tech'},{rank:1,ticker:'AAPL',change:0,industry:'tech',sector:'consumer tech'}]};
    var obj = { one: 1, two: 2, three: 3, four: 4, five: 5 };
    $( document ).ready(function() {
    $('#datepicker').datepicker();

  });
  function myFunction(x) {
    x.classList.toggle("change");
  }
</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/locales/bootstrap-datepicker.en-GB.min.js" charset="UTF-8"></script>

{% endblock %}